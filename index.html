<!DOCTYPE html>
<!-- saved from url=(0063)https://www.registertovote.service.gov.uk/register-to-vote/name -->
<html lang="en" ng-app="patientApp"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    

    <title ng-bind="pageTitle">
Enter Patient ID number
</title>

<script type="text/javascript">
      (function(){if(navigator.userAgent.match(/IEMobile\/10\.0/)){var d=document,c="appendChild",a=d.createElement("style");a[c](d.createTextNode("@-ms-viewport{width:auto!important}"));d.getElementsByTagName("head")[0][c](a);}})();
    </script>

    <!--[if gt IE 8]><!--><link href="./gov-uk-files/govuk-template.css" media="screen" rel="stylesheet" type="text/css"><!--<![endif]-->
    <!--[if IE 6]><link href="https://assets.registertovote.service.gov.uk/assets/d530da8d6263992e9a60e8558776c1b251b60165/template/stylesheets/govuk-template-ie6.css" media="screen" rel="stylesheet" type="text/css" /><![endif]-->
    <!--[if IE 7]><link href="https://assets.registertovote.service.gov.uk/assets/d530da8d6263992e9a60e8558776c1b251b60165/template/stylesheets/govuk-template-ie7.css" media="screen" rel="stylesheet" type="text/css" /><![endif]-->
    <!--[if IE 8]><link href="https://assets.registertovote.service.gov.uk/assets/d530da8d6263992e9a60e8558776c1b251b60165/template/stylesheets/govuk-template-ie8.css" media="screen" rel="stylesheet" type="text/css" /><![endif]-->

    <link href="./gov-uk-files/govuk-template-print.css" media="print" rel="stylesheet" type="text/css">

    <!--[if IE 8]>
    <script type="text/javascript">
      (function(){if(window.opera){return;}
       setTimeout(function(){var a=document,g,b={families:(g=
       ["nta"]),urls:["https://assets.registertovote.service.gov.uk/assets/d530da8d6263992e9a60e8558776c1b251b60165/template/stylesheets/fonts-ie8.css"]},
       c="https://assets.registertovote.service.gov.uk/assets/d530da8d6263992e9a60e8558776c1b251b60165/template/javascripts/vendor/goog/webfont-debug.js",d="script",
       e=a.createElement(d),f=a.getElementsByTagName(d)[0],h=g.length;WebFontConfig
       ={custom:b},e.src=c,f.parentNode.insertBefore(e,f);for(;h=h-1;a.documentElement
       .className+=' wf-'+g[h].replace(/\s/g,'').toLowerCase()+'-n4-loading');},0)
      })()
    </script>
    <![endif]-->
    <!--[if gte IE 9]><!-->
      <link href="./gov-uk-files/fonts.css" media="all" rel="stylesheet" type="text/css">
    <!--<![endif]-->


    <!--[if lt IE 9]>
      <script src="https://assets.registertovote.service.gov.uk/assets/d530da8d6263992e9a60e8558776c1b251b60165/template/javascripts/ie.js" type="text/javascript"></script>
    <![endif]-->

    <link rel="shortcut icon" href="./marys-custom/favicon_64x64.ico" type="image/x-icon">

    <link rel="apple-touch-icon-precomposed" href="./marys-custom/checklist-on-white.png">

    <link rel="apple-touch-icon" href="./marys-custom/checklist-on-white.png">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    
<!--[if gt IE 8]><!--><link href="./gov-uk-files/application.css" media="screen" rel="stylesheet" type="text/css"><!--<![endif]-->
<!--[if IE 6]><link href="https://assets.registertovote.service.gov.uk/assets/d530da8d6263992e9a60e8558776c1b251b60165/stylesheets/application-ie6.css" media="screen" rel="stylesheet" type="text/css" /><![endif]-->
<!--[if IE 7]><link href="https://assets.registertovote.service.gov.uk/assets/d530da8d6263992e9a60e8558776c1b251b60165/stylesheets/application-ie7.css" media="screen" rel="stylesheet" type="text/css" /><![endif]-->
<!--[if IE 8]><link href="https://assets.registertovote.service.gov.uk/assets/d530da8d6263992e9a60e8558776c1b251b60165/stylesheets/application-ie8.css" media="screen" rel="stylesheet" type="text/css" /><![endif]-->

<link href="./gov-uk-files/print.css" media="print" rel="stylesheet" type="text/css">

<link href="./marys-custom/marys.css" media="screen" rel="stylesheet" type="text/css">
<script src="./marys-custom/underscore.js"></script>

<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.10/angular.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.10/angular-animate.js"></script>
<script type="text/javascript">

var questions = {
    "Medical complications" : {
        "You developed a sore arm or inflammation because of a drip (intravenous line)" : null,
        "You caught an infection in the hospital" : {
            "Pneumonia" : null,
            "C.diff colitis" : null,
            "Sepsis / bacteraemia" : null,
            "Urinary tract infection" : null,
            "Phlebitis" : null,
            "Wound infection" : null,
            "Intra-abdominal abscess" : null,
            "Cellulitis" : null
        },
        "You experienced a reaction to a drug" : null,
        "You bled a lot after an operation or after a tube or drain was inserted into you" : null,
        "You developed a collection of blood (haematoma) or fluid (seroma) at the site of an operation or procedure" : null,
        "Your wound opened up enexpectedly (wound dehiscence)" : null,
        "You needed to be transferred to intensive care because of a complication that occurred in hospital" : null,
        "You developed a pressure ulcer (skin wound) in hospital" : null,
        "You had to be re-operated on urgently after your initial operation" : null,
        "You had a fall in hospital" : null,
        "You had a reaction to a blood transfusion" : null,
        "You developed a DVT (deep vein thrombosis) or PE (pulmonary embolism)" : null,
        "You developed a collapsed lung or pneumothorax after a procedure" : null,
        "You required ongoing support with your breathing" : null,
        "You had a heart attack (myocardial infarction) in hospital" : null,
        "You had low blood pressure (hypotension)" : null,
        "Your bowels did not work for a prolonged period (ileus)" : null,
        "Your bowels become blocked (obstruction)" : null,
        "You suffered an unintended injury at the time of the operation" : null,
        "A keyhole or laparoscopic operation had to be converted to open" : null,
        "You developed problems passing urine (oliguria/ failure/ incontinence / retention)" : null,
        "You suffered a stroke (CVA)" : null,
        "You developed worsened anxiety or depression" : null,
        "Your anastomosis leaked after the operation" : null,
        "You had problems with your stoma" : null
    },
    "Healthcare process problems" : {
        "Your medical records were unavailable when needed" : null,
        "You did not receive enough painkillers" : null,
        "Doctors made a wrong diagnosis" : null,
        "You were given food/drink you were not allowed on your diet? (e.g. if you were nil by mouth)" : null,
        "Your fluids in your drip were not changed when they should have been" : null,
        "A test was not done when it should have been" : null,
        "A test was repeated needlessly, by mistake" : null,
        "You were given a drug that was not intended for you" : null,
        "You were confused with another patient during a test or a treatment" : null,
        "A test was cancelled by mistake" : null,
        "An error occurred in a test result" : null,
        "A test, surgical intervention or therapy was performed on the wrong site of your body." : null,
        "The worng implant or prosthesis was used" : null,
        "Something was inappropriately left inside you (retained foreign body)" : null,
        "You discovered that staff did not wash their hands or use alcohol gel before touching you." : null,
        "Staff were unable to obtain a blood sample" : null,
        "You experienced unexplained waits and delays. In what? For how long?" : null,
        "Problems with environment and amenities. In what?" : null,
        "You noticed Inadequate staffing - nurses/doctor/other" : null,
        "You were not monitored or followed-up as planned" : null,
        "A test or procedure was interrupted by Equipment malfunction" : null
    },
    "Medication-related problems" : {
        "You experienced a reaction to a drug" : null,
        "You were prescribed a drug you were allergic to" : null,
        "You were prescribed an Inappropriate choice of drug eg due to contraindication" : null,
        "You were given an infusion or drug that was not intended for you." : null,
        "You were given an infusion or drug at the wrong time" : null,
        "You were given an infusion or drug at the wrong dose" : null,
        "An infusion or drug was omitted, by mistake." : null,
        "There was a delay in giving you your medication" : null,
        "Failure to order drug" : null
    },
    "Interpersonal problems" : {
        "Your diagnosis was not explained to you." : null,
        "You were not explained about what to expect from your treatment while in hospital" : null,
        "The purpose of the medication was not explained to you" : null,
        "The side effects of your medication were not explained to you" : null,
        "Health care staff did not introduce themselves and explain who they were" : null,
        "You were addressed informally without your agreement" : null,
        "You were not explained how the ward works? (e.g. where the toilets are, what time meals are?)" : null,
        "You were not given enough information about your care after discharge from hospital" : null,
        "You were not treated with dignity and respect by the doctors and nurses" : null,
        "You did not feel that you could ask questions to doctors and nurses if you wanted to" : null,
        "Doctors or nurses did not respect confidentiality" : null,
        "Doctors or nurses ignored information you gave them" : null,
        "Your consent was not obtained before a test or an intervention" : null,
        "You were pushed to undergo a test or a treatment against your wish" : null,
        "You were handled or moved with roughness" : null,
        "You felt physically abused" : null
    },
    "Other" : null
};

var getAllPaths = function(obj) {
    if (obj) {
        return _.flatten(_.map(obj, function(val, name) {
            var subNames = getAllPaths(val);
            return subNames
                ? _.map(subNames, function(subName) { return name + " > " + subName; })
                : name;
        }));
    }
};

var decomposePaths = function(paths) {
    return paths.split(" > ");
}

angular
    .module('patientApp', ['ngAnimate'])
    .controller('MainController', function($rootScope, $scope) {
        $scope.isLoggedIn = false;
        $rootScope.pageTitle = "Enter Patient ID number";

        $scope.currentQuestionPath = [];
        $scope.holder = {
          searchText : ""
        }; // bypass the child scope databinding problem

        var updateQuestionsForPath = function() {

            if($scope.holder.searchText) {
                var questionsAtPath = {};
                var lowerSearchText = $scope.holder.searchText.toLowerCase();

                _.chain(getAllPaths(questions))
                    .filter(function(q) { return q.toLowerCase().indexOf(lowerSearchText) > -1; })
                    .each(function(q) { questionsAtPath[q] = null; })
                    .value();

                $rootScope.pageTitle = "Search results for \"" + $scope.holder.searchText + "\"";
            }
            else {
                var questionsAtPath = questions;
                var validatedPath = [];
                for (var i = 0; i < $scope.currentQuestionPath.length; i++) {
                    var pathStep = $scope.currentQuestionPath[i];
                    if (questionsAtPath && questionsAtPath.hasOwnProperty(pathStep)) {
                        questionsAtPath = questionsAtPath[pathStep];
                        validatedPath.push(pathStep);
                    }
                }
                $scope.currentQuestionPath = validatedPath;
                $rootScope.pageTitle = $scope.currentQuestionPath[0] || "What would you like to report?";
            }

            $scope.currentQuestions = questionsAtPath;
            $scope.visual_state = $scope.isLoggedIn
              ? (($scope.currentQuestions) ? "chooseAQuestion" : "enterFreeText")
              : "notLoggedIn";
            $scope.searchIsVisible = ($scope.visual_state == "chooseAQuestion");
            $scope.greySearchBar = $scope.searchIsVisible && $scope.currentQuestionPath && $scope.currentQuestionPath.length;
        };

        $scope.$watch($scope.holder.searchText, updateQuestionsForPath);

        $scope.logIn = function() {
            // TODO login
            $scope.isLoggedIn = true;
            $scope.currentQuestionPath = [];
            $scope.holder.searchText = "";
            updateQuestionsForPath();
        };

        $scope.chooseQuestion = function(questionSelection) {
            var splitQ = decomposePaths(questionSelection);
            for (var i = 0; i < splitQ.length; i++) {
                $scope.currentQuestionPath.push(splitQ[i]);
            }
            $scope.holder.searchText = "";
            updateQuestionsForPath();
        };

        $scope.find = updateQuestionsForPath;
    });
</script>
  </head>

  <body class="js-enabled" ng-controller="MainController">
    <script type="text/javascript">document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div id="skiplink-container">
      <div>
        <a href="https://www.registertovote.service.gov.uk/register-to-vote/name#content" class="skiplink">Skip to main content</a>
      </div>
    </div>
    
    <header role="banner" id="global-header" class="with-proposition">
      <div class="header-wrapper">
        <div class="header-global">
          <div class="header-logo">
            <a href="index.html" id="logo" class="content">
              <img src="./marys-custom/checklist-on-white.png" width="35" height="31" alt=""> EPIC
            </a>
          </div>
        </div>
        <div class="header-proposition">
        <div class="content">
          <nav id="proposition-menu">
            <a href="index.html" id="proposition-name">
              
              Empowering Patients to Improve Care
            </a>
          </nav>
        </div>
      </div>

      </div>
    </header>
    <!--end header-->    

    <div id="global-header-bar" ng-class="{ searchIsVisible : searchIsVisible, greySearchBar :  greySearchBar }">
      <div class="header-bar">
        <div class="inner-block">
          <div class="header-bar-inner">
          </div>
        </div>

          <form id="search" class="site-search" ng-if="searchIsVisible">
            <div class="content">
              <label for="site-search-text" class="visuallyhidden">Search</label>
              <input type="search" ng-model="holder.searchText" id="site-search-text" title="Search" class="js-search-focus search-text"
                  ng-change="find()"><input type="submit" class="submit search-submit" value="search" />
            </div>
          </form>

      </div>
    </div>
    <!--end global-header-bar-->

<main id="content" class="">
  <div ng-switch on="visual_state">

    <div class="validate step" ng-switch-default>
      <form ng-submit="logIn()">
        <header class="question-one">
            <h4>Log in</h4>
            <h1>What is the patient's study ID number?</h1>
        </header>

        <label for="" class="visuallyhidden">
            What is the patient's study ID number?
        </label>

        <div class="">
            <input type="text" id="NINO_NINO" name="NINO.NINO" value="" autocomplete="off" class="text  validate nino " data-validation-name="" data-validation-type="field" data-validation-rules="">
        </div>
        <p class="example">Example: ABC 123 P</p>

        <input type="submit" value="Continue" id="continue" class="u-color-white u-inline-block button next" />
      </form>
    </div>

    <div ng-switch-when="chooseAQuestion">
      <form>
        <header class="question-one">
            <h1>{{pageTitle}}</h1>
            <h3 ng-if="currentQuestionPath.length > 1">
                <span ng-repeat="q in currentQuestionPath" ng-if="!$first">
                    {{q}}
                    <span ng-if="!$last">&gt;</span>
                </span>
            </h3>
        </header>
        <button ng-repeat="(q, obj) in currentQuestions"
                ng-click="chooseQuestion(q)" class="u-color-white button next">
            {{q}}
        </button>
      </form>
    </div>

    <div ng-switch-when="enterFreeText">
      <form ng-submit="logIn()">
        <header class="question-one">
            <h4 ng-repeat="q in currentQuestionPath">
                <span ng-if="$first">{{q}}</span>
            </h4>
            <h2>
                <span ng-repeat="q in currentQuestionPath">
                    <span ng-if="!$first">
                        {{q}}
                        <span ng-if="!$last">&gt;</span>
                    </span>
                </span>
            </h2>
            <h1>Please describe what happened</h1>
        </header>

        <label for="" class="visuallyhidden">
            Please describe what happened
        </label>

        <div class="">
            <textarea rows="4" id="NINO_NINO" name="NINO.NINO" value="" autocomplete="off" class="text validate u-full-width" data-validation-name="" data-validation-type="field" data-validation-rules=""></textarea> 
        </div>
        <p class="example">Example: I was given blood that didn't match my blood type - the nurses got mixed up and switched the bloods with someone else on the ward.</p>

        <input type="submit" value="Send your feedback" id="continue" class="u-color-white u-inline-block button next" />
      </form>
    </div>
  </div>
</main>

    <footer class="group js-footer" id="footer" role="contentinfo">
      <div class="footer-wrapper">

        <div class="footer-meta">
          <div>
            <h2 class="visuallyhidden">
              Support links
            </h2>
            <p>
                © copyright
                <a href="http://sastrugisoftware.com/">
                  Sastrugi Software
                </a>
            </p>
          </div>

        </div>
      </div>
    </footer>

    <!--end footer-->

    <div id="global-app-error" class="app-error hidden"></div>

    <script src="./gov-uk-files/govuk-template.js" type="text/javascript"></script>

    <script src="./gov-uk-files/cache-busting.js"></script>
<script src="./gov-uk-files/jquery-1.10.1.min.js"></script>
<script src="./gov-uk-files/mustache.js"></script>
<script src="./gov-uk-files/typeahead.js"></script>
<script src="./gov-uk-files/core.js"></script>
<script src="./gov-uk-files/countries.js"></script>
<script src="./gov-uk-files/messages.js"></script>
<script src="./gov-uk-files/validation.js"></script>
<script src="./gov-uk-files/forms.js"></script>
<script src="./gov-uk-files/onready.js"></script>
<script src="./gov-uk-files/local-fix.js"></script>


  
</body></html>
